var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,i=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,r=(e,a)=>{for(var t in a||(a={}))o.call(a,t)&&i(e,t,a[t]);if(l)for(var t of l(a))s.call(a,t)&&i(e,t,a[t]);return e};import{c as d,d as n,e as p}from"./index.f0d419ad.js";import{a as u,_ as c}from"./index.c7afcf21.js";import{ay as m,d as b,i as f,c as h,f as g,w as v,b as w,u as y,E as _,a as x,r as D,P,Q as k,g as V,t as j,e as O,v as C,x as R,h as T,aA as B}from"./vendor.b96c6562.js";import{u as S}from"./useBasicTable.55f42f90.js";import{u as E}from"./useDialog.82336297.js";import{u as G}from"./useBasicForm.209940da.js";const $=[{field:"package_id",label:"赠送套餐：",component:"ApiSelect",defaultValue:[],componentProps:{placeholder:"请选择套餐",style:{width:"100%"},api:u().chatGPT.packageList,resultField:"data",labelField:"name",valueField:"id",filterable:!0}}],F={class:"box"},I=b({__name:"GiftDialog",props:{modelValue:{type:[Boolean],default:!1},editData:{type:[null,Object],default:()=>null}},emits:["update:modelValue","reload"],setup(e,{emit:a}){const t=e,{register:l,validate:o}=G({schemas:$}),{handlePopup:s}=E({emit:a,props:t,watchShow:async()=>{t.editData}}),i=async()=>{try{const{id:l}=t.editData,i=await o();if(!i.package_id)return void _.error("请选择套餐");try{await u().chatGPT.sendPackage(r({user_id:l},i)),_.success("赠送成功")}catch(e){}s(!1),a("reload")}catch(e){}};return(a,t)=>(f(),h("div",null,[g(y(n),{"dialog-props":{title:"赠送套餐",modelValue:e.modelValue,showClose:!0,width:"400px"},center:"",onCancel:t[0]||(t[0]=e=>y(s)(!1)),onSubmit:i},{default:v((()=>[w("div",F,[g(y(d),{onRegister:y(l)},null,8,["onRegister"])])])),_:1},8,["dialog-props"])]))}});const A=e=>(C("data-v-d4c57166"),e=e(),R(),e),L={key:0,class:"box"},U={class:"box-balance"},Q=A((()=>w("div",{class:"box-balance-title"}," 套餐余额： ",-1))),q={class:"cb-m-r-25"},z=A((()=>w("span",null,"套餐名称：",-1))),H={key:0},J=A((()=>w("span",null,"到期时间：",-1))),K={key:1},M=A((()=>w("span",null,"剩余有效次数：",-1)));var N=c(b({__name:"BalanceDetail",props:{modelValue:{type:[Boolean],default:!1},editData:{type:[null,Object],default:()=>null}},emits:["update:modelValue","reload"],setup(e,{emit:l}){const o=e,s=x({}),i=D([]),{registerTable:d,reload:c}=S({columns:[{label:"套餐名称",prop:"package_name"},{label:"问答机会",prop:"num",slot:"num",width:"120"},{label:"日期",prop:"created_at"}],showTableCard:!1}),{handlePopup:m}=E({emit:l,props:o,watchShow:async()=>{if(o.editData){const{id:e}=o.editData,{data:a}=await u().chatGPT.getEnablePackage({user_id:e});i.value=a}}});return(l,o)=>(f(),h("div",null,[g(y(n),{"dialog-props":{title:"套餐余额",modelValue:e.modelValue,showClose:!0,width:"650px"},"btn-props":{submitBtnOptions:{show:!1}},center:"",onCancel:o[0]||(o[0]=e=>y(m)(!1))},{default:v((()=>{return[e.modelValue&&e.editData?(f(),h("div",L,[w("div",U,[Q,(f(!0),h(P,null,k(i.value,(e=>(f(),h("div",{key:e.id,class:"box-balance-item cb-flex"},[w("div",q,[z,V(j(e.name),1)]),-1===e.num?(f(),h("div",H,[J,V(j(e.expired_at),1)])):(f(),h("div",K,[M,V(j(e.num-e.used),1)]))])))),128))]),g(y(p),{onRegister:y(d),api:l.$api.user.getPackageRecord,height:"auto",extraParams:(o=r({},s),n={user_id:e.editData.id},a(o,t(n)))},{num:v((e=>[V(j(-1===e.num?`+ ${e.expired_day}天`:`+ ${e.num}次`),1)])),_:1},8,["onRegister","api","extraParams"])])):O("",!0)];var o,n})),_:1},8,["dialog-props"])]))}}),[["__scopeId","data-v-d4c57166"]]);const W={class:"cb-page page-user"},X=V(" 查看 "),Y=V(" 赠送 "),Z=b({__name:"index",setup(e){const{showDialog:a,editData:t,openEdit:l}=E({}),{showDialog:o,editData:s,openEdit:i}=E({}),{registerTable:r,reload:d}=S({columns:[{label:"头像",prop:"avatar",slot:"avatar",width:100},{label:"昵称",prop:"nickname"},{label:"手机号",prop:"mobile",width:200},{label:"套餐余额",slot:"balance",width:100},{label:"创建时间",prop:"register_at",width:200},{label:"用户状态",prop:"status",customRender:({status:e})=>{const a={1:"正常",2:"冻结中"};return 1==e?a[e]:m("span",{style:{color:"red"}},{default:()=>a[e]})}},{label:"操作",width:100,slot:"handles"}],formSchemas:[{field:"nickname",component:"Input",label:"昵称",componentProps:{placeholder:"请输入昵称"}},{field:"mobile",component:"Input",label:"手机号",componentProps:{placeholder:"请输入手机号"}}]});return(e,d)=>{const n=T("el-image"),u=T("el-button");return f(),h("div",W,[g(y(p),{onRegister:y(r),api:e.$api.chatGPT.memberList},{avatar:v((({avatar:a})=>[g(n,{style:{width:"50px",height:"50px"},src:a||e.$images.default,fit:"fill"},null,8,["src"])])),balance:v((e=>[g(u,{type:"text",onClick:a=>y(i)(e)},{default:v((()=>[X])),_:2},1032,["onClick"])])),handles:v((e=>[g(u,{type:"text",onClick:a=>y(l)(e)},{default:v((()=>[Y])),_:2},1032,["onClick"])])),_:1},8,["onRegister","api"]),g(I,{modelValue:y(a),"onUpdate:modelValue":d[0]||(d[0]=e=>B(a)?a.value=e:null),editData:y(t)},null,8,["modelValue","editData"]),g(N,{modelValue:y(o),"onUpdate:modelValue":d[1]||(d[1]=e=>B(o)?o.value=e:null),editData:y(s)},null,8,["modelValue","editData"])])}}});export{Z as default};
