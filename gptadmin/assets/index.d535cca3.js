var e=Object.defineProperty,l=Object.defineProperties,a=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,s=(l,a,t)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[a]=t,d=(e,l)=>{for(var a in l||(l={}))o.call(l,a)&&s(e,a,l[a]);if(t)for(var a of t(l))n.call(l,a)&&s(e,a,l[a]);return e},i=(e,t)=>l(e,a(t));import{a as r,M as c,E as p,d as u,h as m,i as b,s as h,w as f,b as v,f as g,u as w,g as y,v as V,x as P,m as k,o as _,c as I,az as q,P as x,Q as C,t as D,bw as j,bx as U,aA as N}from"./vendor.805d0475.js";import{a as O,_ as S}from"./index.afdd0a4f.js";import{c as L,d as z}from"./index.1b2875f3.js";import{u as E}from"./useDialog.796bffee.js";import{u as G}from"./useBasicForm.4db03463.js";const R=()=>{const e=r({packageList:[],page:{page:1,per_page:199}}),l=async()=>{try{const{data:l}=await O().chatGPT.packageList(d({},e.page));e.packageList=l}catch(l){}};return i(d({},c(e)),{onGetPackageList:l,onCreatePackage:async(e,l)=>{try{const a=!!e.id,{err_code:t}=await O().chatGPT[a?"putPackage":"savePackage"](d({},e));t||(p.success(a?"修改成功":"新增成功"),l&&l())}catch(a){}},onPackageShow:async e=>{try{const{err_code:a}=await O().chatGPT.putPackageShow({id:e.id});a||l()}catch(a){}},onCheckInputValue:e=>{}})};const B=e=>(V("data-v-79a703ba"),e=e(),P(),e),F={class:"package"},T=y(" ￥ "),A=B((()=>v("div",{class:"text"},"购买后展示到个人中心的名称",-1))),M=B((()=>v("div",{class:"text"},[v("p",null,"支持输入0-10000的整数"),v("p",null,"按天数：购买后几天有效，输入0时表示有效期至2099年"),v("p",null,"按次数：购买后可使用几次对话")],-1))),H=B((()=>v("div",{class:"text"},"有多个套餐时等级越高，则优先扣费",-1)));var Q=S(u({__name:"ListCreateDialog",props:{modelValue:{type:[Boolean],default:!1},editData:{type:[Array],default:()=>null}},emits:["update:modelValue","reload"],setup(e,{emit:l}){var a;const t=e,{register:o,validate:n,setFieldsValue:s,resetFields:r,setProps:c}=G({schemas:(null==(a=t.editData)||a.id,[{field:"name",component:"Input",label:"套餐名称",required:!0,componentProps:{maxlength:"20",placeholder:"售卖时的名称"}},{field:"show_name",component:"Input",label:"显示名称",required:!0,slot:"show_name",componentProps:{placeholder:"请输入展示名称"}},{field:"code",component:"Select",label:"类型",componentProps:{style:{width:"100%"},options:[{label:"按次数",value:"num"},{label:"按天数",value:"date"}]},defaultValue:"num",required:!0},{field:"num",component:"InputNumber",label:"有效数量",required:!0,slot:"num"},{field:"price",component:"Input",label:"价格",required:!0,slot:"price"},{field:"level",component:"InputNumber",label:"扣费等级",required:!0,slot:"level"},{field:"sort",component:"InputNumber",label:"排序",required:!0,componentProps:{style:{width:"100%"},min:0},defaultValue:0},{field:"show",component:"Input",label:"是否展示",required:!0,defaultValue:"0",show:!1}])}),{getEditId:p,getEdit:u,handlePopup:y}=E({props:t,emit:l,watchShow:e=>{if(t.editData){const{identity:e,type:l,show:a,id:o}=t.editData;c({schemas:[{field:"name",component:"Input",label:"套餐名称",required:!0,componentProps:{maxlength:"20",placeholder:"售卖时的名称"}},{field:"show_name",component:"Input",label:"显示名称",required:!0,slot:"show_name",componentProps:{placeholder:"请输入展示名称"}},{field:"code",component:"Select",label:"类型",componentProps:{style:{width:"100%"},options:[{label:"按次数",value:"num"},{label:"按天数",value:"date"}]},defaultValue:"num",required:!0},{field:"num",component:"InputNumber",label:"有效数量",required:!0,slot:"num"},{field:"price",component:"Input",label:"价格",required:!0,slot:"price"},{field:"level",component:"InputNumber",label:"扣费等级",required:!0,slot:"level"},{field:"sort",component:"InputNumber",label:"排序",required:!0,componentProps:{style:{width:"100%"},min:0},defaultValue:0},{field:"show",component:"Input",label:"是否展示",required:!0,defaultValue:"0",show:!1}]}),s(i(d({},t.editData),{identity:e+"",type:l+"",show:a+""}))}else c({schemas:[{field:"name",component:"Input",label:"套餐名称",required:!0,componentProps:{maxlength:"20",placeholder:"售卖时的名称"}},{field:"show_name",component:"Input",label:"显示名称",required:!0,slot:"show_name",componentProps:{placeholder:"请输入展示名称"}},{field:"code",component:"Select",label:"类型",componentProps:{style:{width:"100%"},options:[{label:"按次数",value:"num"},{label:"按天数",value:"date"}]},defaultValue:"num",required:!0},{field:"num",component:"InputNumber",label:"有效数量",required:!0,slot:"num"},{field:"price",component:"Input",label:"价格",required:!0,slot:"price"},{field:"level",component:"InputNumber",label:"扣费等级",required:!0,slot:"level"},{field:"sort",component:"InputNumber",label:"排序",required:!0,componentProps:{style:{width:"100%"},min:0},defaultValue:0},{field:"show",component:"Input",label:"是否展示",required:!0,defaultValue:"0",show:!1}]})}}),{onCreatePackage:V,onCheckInputValue:P}=R(),k=async()=>{const e=await n(),a=t.editData?i(d({},e),{id:t.editData.id}):e;V(a,(()=>{y(),l("reload")}))},_=()=>{y(!1),r()};return(l,a)=>{const t=m("el-input-number"),n=m("el-input");return b(),h(w(z),{"dialog-props":{title:"套餐新增",modelValue:e.modelValue,showClose:!0,width:"800px"},scrollBarProps:{maxHeight:500},center:"",top:"10vh",onCancel:_,onSubmit:k},{default:f((()=>[v("div",F,[g(w(L),{onRegister:w(o)},{price:f((({model:e,field:l})=>[g(t,{modelValue:e[l],"onUpdate:modelValue":a=>e[l]=a,placeholder:"请输入价格",precision:2,step:.1,min:.01,style:{width:"100%"},"controls-position":"right",class:"input-with-select"},{append:f((()=>[T])),_:2},1032,["modelValue","onUpdate:modelValue","step","min"])])),show_name:f((({model:e,field:l})=>[g(n,{modelValue:e[l],"onUpdate:modelValue":a=>e[l]=a,placeholder:"请输入展示名称",class:"input-with-select"},null,8,["modelValue","onUpdate:modelValue"]),A])),num:f((({model:e,field:l})=>[g(t,{modelValue:e[l],"onUpdate:modelValue":a=>e[l]=a,placeholder:"请输入数量",type:"number",max:1e4,min:0,style:{width:"100%"},"controls-position":"right"},null,8,["modelValue","onUpdate:modelValue"]),M])),level:f((({model:e,field:l})=>[g(t,{modelValue:e[l],"onUpdate:modelValue":a=>e[l]=a,placeholder:"请输入套餐等级",min:"0",precision:0,style:{width:"100%"},"controls-position":"right",class:"input-with-select"},null,8,["modelValue","onUpdate:modelValue"]),H])),_:1},8,["onRegister"])])])),_:1},8,["dialog-props"])}}}),[["__scopeId","data-v-79a703ba"]]);const J={class:"cb-page package"},K={class:"package-head cb-m-b-20"},W={class:"cb-flex"},X=v("span",{class:"cb-p-t-2"},"新增",-1),Y={key:0,class:"package-list cb-flex"},Z={class:"box cb-flex cb-m-b-6"},$={class:"box-left cb-m-r-10"},ee={class:"box-right"},le={class:"name"},ae={class:"name"},te={class:"name"},oe={class:"name"},ne={class:"buttom cb-flex"},se={class:"cb-flex"},de={class:"cb-m-r-20"},ie={class:"cb-m-r-10"},re=u({__name:"index",setup(e){const l=k(),{openEdit:a,editData:t,showDialog:o}=E({}),{onGetPackageList:n,packageList:s,onPackageShow:d}=R();_((()=>{n()}));return(e,i)=>{const r=m("el-icon"),c=m("el-button"),p=m("el-switch"),u=m("el-empty"),V=m("el-card");return b(),I("div",J,[g(V,null,{default:f((()=>[v("div",K,[g(c,{type:"primary",onClick:i[0]||(i[0]=e=>w(a)(null))},{default:f((()=>[v("div",W,[g(r,{size:20,class:"cb-m-r-2"},{default:f((()=>[g(w(q))])),_:1}),X])])),_:1})]),w(s).length>0?(b(),I("div",Y,[(b(!0),I(x,null,C(w(s),(e=>(b(),I("div",{class:"package-list-item cb-p-15",key:e.id},[v("div",Z,[v("div",$," ￥"+D(e.price),1),v("div",ee,[v("div",le,"名称："+D(e.name),1),v("div",ae,"套餐次数："+D(-1===e.num?"不限次数":e.num+"次"),1),v("div",te,"有效时间："+D(0===e.expired_day?"不限时间":e.expired_day+"天"),1),v("div",oe,[y("价格："+D(e.price)+" ",1),g(r,{size:20,color:"var(--el-color-primary)",onClick:l=>w(a)(e)},{default:f((()=>[g(w(j))])),_:2},1032,["onClick"])])])]),v("div",ne,[v("div",se,[v("span",de," 已支付总金额："+D(e.order_sum_payment||"0.00"),1),v("span",ie,"购买数量："+D(e.order_count||0),1),g(r,{size:20,color:"var(--el-color-primary)",onClick:a=>(({id:e})=>{l.push({path:"/order/orderManager/list",query:{id:e}})})(e)},{default:f((()=>[g(w(U))])),_:2},1032,["onClick"])]),g(p,{modelValue:e.show,"onUpdate:modelValue":l=>e.show=l,onClick:l=>(({id:e})=>{d({id:e})})(e),"active-value":1,"inactive-value":0},null,8,["modelValue","onUpdate:modelValue","onClick"])])])))),128))])):(b(),h(u,{key:1,"image-size":200}))])),_:1}),g(Q,{modelValue:w(o),"onUpdate:modelValue":i[1]||(i[1]=e=>N(o)?o.value=e:null),editData:w(t),onReload:w(n)},null,8,["modelValue","editData","onReload"])])}}});export{re as default};
